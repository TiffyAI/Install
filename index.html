<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install Motion Power Sphere</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0d1117;
            color: #c9d1d9;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            z-index: 10;
            max-width: 90%;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .content {
            z-index: 20;
            background: rgba(13, 17, 23, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid rgba(48, 54, 61, 0.5);
            margin-top: 1rem;
            max-width: 500px;
        }
        #installButton {
            transition: all 0.3s ease-in-out;
            border: 2px solid transparent;
        }
        #installButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(48, 54, 61, 0.4);
            border: 2px solid #58a6ff;
        }
        .message-box {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            max-width: 400px;
            text-align: left;
            word-wrap: break-word;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .message-box.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="content flex flex-col items-center">
            <h1 class="text-4xl sm:text-5xl font-bold mb-4">Motion Power Sphere</h1>
            <p class="text-lg sm:text-xl text-gray-400 mb-6">Experience the dynamic Motion Power Sphere. Pop this awesome earning experience on your Home Screen for a full-screen experience and offline access to earning valuable TIFFY tokens offline</p>
            <button id="installButton" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-full text-lg shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Play Now
            </button>
            <div id="messageBox" class="message-box"></div>
        </div>
    </div>

    <!-- PWA Manifest & Service Worker Script -->
    <script>
        // Inline Manifest JSON
        const manifest = {
            name: "Motion Power Sphere",
            short_name: "Sphere",
            description: "A dynamic sphere of motion.",
            start_url: "/",
            display: "standalone",
            background_color: "#0d1117",
            theme_color: "#161b22",
            icons: [
                { src: "https://tiffyai.github.io/Blue-Key-Claim/TiffyAI-Token.png", sizes: "192x192", type: "image/png" },
                { src: "https://tiffyai.github.io/Blue-Key-Claim/TiffyAI-Token.png, sizes: "512x512", type: "image/png" }
            ]
        };

        // Create a link tag for the manifest
        const linkEl = document.createElement('link');
        linkEl.rel = 'manifest';
        linkEl.href = 'data:application/json;base64,' + btoa(JSON.stringify(manifest));
        document.head.appendChild(linkEl);

        // --- Three.js Sphere Animation ---
        let scene, camera, renderer, sphere, controls;
        let ambientLight, directionalLight;

        function init3D() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0d1117);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 2.5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.insertBefore(renderer.domElement, document.body.firstChild);

            // Sphere
            const geometry = new THREE.IcosahedronGeometry(1, 1);
            const material = new THREE.MeshPhongMaterial({
                color: 0x58a6ff,
                shininess: 30,
                specular: 0xffffff,
                flatShading: true
            });
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);

            // Lighting
            ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambientLight);
            directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 5, 5).normalize();
            scene.add(directionalLight);

            // Handle mouse/touch movement for tilt effect
            let mouseX = 0;
            let mouseY = 0;

            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
            });
            document.addEventListener('touchmove', (event) => {
                if (event.touches.length > 0) {
                    mouseX = (event.touches[0].clientX / window.innerWidth) * 2 - 1;
                    mouseY = -(event.touches[0].clientY / window.innerHeight) * 2 + 1;
                }
            });

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            // Dynamic tilting based on mouse/touch position
            sphere.rotation.x += (mouseY * 0.05 - sphere.rotation.x) * 0.05;
            sphere.rotation.y += (mouseX * 0.05 - sphere.rotation.y) * 0.05;
            renderer.render(scene, camera);
        }

        window.onload = function() {
            init3D();
            animate();
        };

        // --- PWA Installation Logic ---
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const messageBox = document.getElementById('messageBox');

        // Function to show a message in the message box
        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.style.backgroundColor = isError ? '#631c1c' : '#21262d';
            messageBox.style.borderColor = isError ? '#f85149' : '#30363d';
            messageBox.classList.add('show');
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevents the default browser install prompt
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            // The button should be visible if the event fires
            installButton.style.display = 'block';
            console.log('beforeinstallprompt fired');
        });

        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    showMessage('The app was installed successfully!');
                } else {
                    showMessage('Installation was dismissed.');
                }
                // We no longer need the prompt, so clear it
                deferredPrompt = null;
            } else {
                showMessage('The app is already installed or cannot be installed.', true);
            }
        });

        // Register the Service Worker (to allow offline functionality)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
self.addEventListener('install', (event) => {
    event.waitUntil(
        caches.open('motion-power-sphere-v1').then((cache) => {
            return cache.addAll([
                '/',
                'index.html'
            ]);
        })
    );
    self.skipWaiting();
});

self.addEventListener('fetch', (event) => {
    event.respondWith(
        caches.match(event.request).then((response) => {
            return response || fetch(event.request);
        })
    );
});
`;
                const swBlob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(swBlob);

                navigator.serviceWorker.register(swUrl)
                    .then((reg) => {
                        console.log('Service Worker registered with scope:', reg.scope);
                    })
                    .catch((err) => {
                        console.error('Service Worker registration failed:', err);
                    });
            });
        }
    </script>
</body>
</html>
