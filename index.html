<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motion Power Sphere Installer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #0d1117;
        color: #c9d1d9;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    canvas {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 1;
    }
    .content {
        z-index: 20;
        background: rgba(13, 17, 23, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 2rem;
        border-radius: 1rem;
        border: 1px solid rgba(48, 54, 61, 0.5);
        max-width: 500px;
        text-align: center;
    }
    #installButton {
        transition: all 0.3s ease;
        border: 2px solid rgba(88,166,255,0.7);
        background: rgba(13,17,23,0.4);
        color: #58a6ff;
        font-weight: bold;
        text-shadow: 0 0 5px rgba(88,166,255,0.7);
        backdrop-filter: blur(8px);
    }
    #installButton:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 0 15px rgba(88,166,255,0.8);
    }
    .message-box {
        background: #21262d;
        border: 1px solid #30363d;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .message-box.show {
        opacity: 1;
        transform: translateY(0);
    }
</style>
</head>
<body>

<div class="content">
    <h1 class="text-4xl font-bold mb-4">Motion Power Sphere</h1>
    <p class="text-lg text-gray-400 mb-6">
        I‚Äôm the sphere that vibes with your moves. Pop me on your Home Screen ‚Äî I‚Äôll spin, I‚Äôll shine, I‚Äôll party with your taps. 
    </p>
    <button id="installButton" class="py-3 px-6 rounded-full text-lg">
        Pop Me on Your Home Screen!
    </button>
    <div id="messageBox" class="message-box"></div>
</div>

<script>
let mouseX = 0, mouseY = 0;
let scene, camera, renderer, sphere;

// Preload click sound
const clickSound = new Audio('click.wav');

// Link to real manifest in /app/
const linkEl = document.createElement('link');
linkEl.rel = 'manifest';
linkEl.href = './app/manifest.json';
document.head.appendChild(linkEl);

// Init 3D sphere
function init3D() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0d1117);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 2.5;

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.insertBefore(renderer.domElement, document.body.firstChild);

    const geometry = new THREE.IcosahedronGeometry(1, 1);
    const material = new THREE.MeshPhongMaterial({
        color: 0x58a6ff,
        shininess: 30,
        specular: 0xffffff,
        flatShading: true
    });
    sphere = new THREE.Mesh(geometry, material);
    scene.add(sphere);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
    directionalLight.position.set(5, 5, 5).normalize();
    scene.add(directionalLight);

    // Mouse move
    document.addEventListener('mousemove', e => {
        mouseX = (e.clientX / window.innerWidth) * 2 - 1;
        mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
    });

    // Touch move
    document.addEventListener('touchmove', e => {
        if (e.touches.length > 0) {
            mouseX = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
            mouseY = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
        }
    });

    // Device tilt
    if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', e => {
            if (e.gamma && e.beta) {
                mouseX = e.gamma / 45;
                mouseY = e.beta / 45;
            }
        });
    }

    window.addEventListener('resize', onWindowResize, false);
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    sphere.rotation.x += (mouseY * 0.5 - sphere.rotation.x) * 0.05;
    sphere.rotation.y += (mouseX * 0.5 - sphere.rotation.y) * 0.05;
    renderer.render(scene, camera);
}

window.onload = () => {
    init3D();
    animate();
};

// PWA Install Logic
let deferredPrompt;
const installButton = document.getElementById('installButton');
const messageBox = document.getElementById('messageBox');

function showMessage(text) {
    messageBox.textContent = text;
    messageBox.classList.add('show');
}

window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;
    installButton.style.display = 'block';
});

installButton.addEventListener('click', async () => {
    clickSound.play();
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
            showMessage('üöÄ Locked & loaded! Your sphere is now chillin‚Äô on your Home Screen.');
        } else {
            showMessage('üòè You blinked. Try again when you‚Äôre ready.');
        }
        deferredPrompt = null;
    } else {
        showMessage('ü§ñ Already hanging out on your Home Screen.');
    }
});
</script>
</body>
</html>
